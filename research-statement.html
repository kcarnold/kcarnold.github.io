<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>research-statement – Ken Arnold (Calvin U)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-6bd9cfa162949bde0a231f530c97869d.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-6SPV9Y5XFG"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-6SPV9Y5XFG', { 'anonymize_ip': true});
</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Ken Arnold (Calvin U)</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="./posts.html"> 
<span class="menu-text">Posts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./pubs.html"> 
<span class="menu-text">Publications</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./projects.html"> 
<span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./static/kcarnold_cv.pdf"> 
<span class="menu-text">CV</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/kcarnold"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/kcarnold"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"></header>




<section id="research-statement" class="level1">
<h1>Research Statement</h1>
<section id="thoughtful-ai" class="level2">
<h2 class="anchored" data-anchor-id="thoughtful-ai">Thoughtful AI</h2>
<p>Technological artifacts are not neutral; they shape how we act, how we see each other, how we think, what we value <span class="citation" data-cites="5096 4942 178">[@5096; @4942; @178]</span>. This is particularly true in technologies that mediate how people interact with each other, such as media and now generative AI, which injects computational judgments into how we compose our communications and how we perceive others’ communications with us. By shaping how we think about each other, these technologies risk doing wrong to each other, such as dishonoring our email recipients and educators through computer-generated simulacra of empathetic and thoughtful prose. But my work embodies a hope that it doesn’t have to be that way: shaped rightly, AI could help us <em>do justice towards one another</em> through thoughtful communication, perspective-taking, and reflective strategy.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
</section>
<section id="dark-side-of-ai-productivity" class="level2">
<h2 class="anchored" data-anchor-id="dark-side-of-ai-productivity">Dark side of AI Productivity</h2>
<p>Narratives around intelligent systems (especially generative AI) has typically centered on <em>speed</em> and <em>scale</em>: how can we get more done in less time? But productivity-enhancing systems like text generation systems have been found to encourage people using them to align with their biases (see my work<span class="citation" data-cites="1969">[@1969]</span> and others<span class="citation" data-cites="5053 5027">[@5053; @5027]</span>), increase risk of errors<span class="citation" data-cites="56">[@56]</span>, and risk homogenizing creative expression <span class="citation" data-cites="4964 4908">[@4964; @4908]</span>, among other challenges.</p>
<p>My dissertation work inaugurated the study of how predictive text entry systems might affect the content of written communication. Although predictive text was already ubiquitous on smartphones and starting to get deployed in other interfaces, academic research on it had only evaluated its effects on <em>productivity</em> (e.g., text entry speed and accuracy). No one (to my knowledge) had questioned what effect it might have on the <em>content</em> of writing. But once I started looking I found many ways that predictive text nudges writers to conform to system’s suggestions (word choice <span class="citation" data-cites="1960">[@1960]</span>, level of detail <span class="citation" data-cites="1796">[@1796]</span>, stance <span class="citation" data-cites="1969">[@1969]</span>).</p>
<p>Since suggestions can preempt human thinking, self-reported reflection is insufficient to document how writing with suggestions compares with what people <em>would have written</em> counterfactually without the suggestions. So I ran controlled experiments using repeatable writing tasks and devised quantitative measures to tease out these conformity effects. In the years since I published this work, many other researchers have replicated and extended these findings <span class="citation" data-cites="4964 5101 1877 5053">[@4964; @5101; @1877; @5053]</span>. To run these experiments, I designed and implemented a custom mobile predictive-text keyboard, including an innovative phrase-suggestion interface, and wrote inference code to generate within-word and next-word predictions from n-gram and LSTM language models (including one configuration where the predictions were conditioned on image embeddings).</p>
</section>
<section id="supporting-thoughtful-writing-through-alternative-interactions" class="level2">
<h2 class="anchored" data-anchor-id="supporting-thoughtful-writing-through-alternative-interactions">Supporting Thoughtful Writing through Alternative Interactions</h2>
<p>Reflecting on my dissertation findings, I conjectured that the problematic nature of the predictive interactions I’d studied was mediated through an implicit value of <em>fast content production</em> instead of <em>cognitive engagement</em>. By presenting suggestions that humans could accept as their own with minimal thought or interaction, these prediction-based interfaces embody a value of quantity over thoughtfulness. Although disciplined people can still use these systems in thoughtful ways, the default is cognitive disengagement; human participation becomes passive. We must study how AI can help us think not <em>less</em> but <em>better</em>.</p>
<p>The problem of cognitive disengagement also occurs in AI decision-support systems: people over-rely on the recommendations, leading to lower performance and less human learning. However, one intervention has been shown to be effective at maintain cognitive engagement in AI decision-making: hiding the prediction and showing only the AI explanation <span class="citation" data-cites="22">[@22]</span>.</p>
<section id="thought-embers-suggestions-that-require-writers-to-think" class="level3">
<h3 class="anchored" data-anchor-id="thought-embers-suggestions-that-require-writers-to-think">Thought Embers: suggestions that require writers to think</h3>
<p>What if AI helped us come up with questions, not answers, as Licklider suggested back in 1960 <span class="citation" data-cites="5097">[@5097]</span>? Can presenting fragments of ideas, rather than complete and usable ideas, help writers retain agency over their work? In Summer 2024, I worked with a team of 4 students (3 undergraduate, 1 high school) to study how the type of information suggested by an AI writing assistant affects writers’ cognitive engagement with the suggestion and how they appropriate that suggestion in their draft. We developed a Microsoft Word sidebar that offered next-sentence suggestions expressed in four different ways: in addition to predictive-text-style <em>examples</em> they could use verbatim (e.g., by copy-and-paste), we also allowed writers to request <em>questions</em> that the next sentence might answer, <em>vocabulary</em> they might use, and <em>rhetorical moves</em> (such as giving examples or considering counterarguments) that their next sentence might engage with. Students conceptualized these interventions, designed prompting and post-processing approaches for the NLP backend, and designed and implemented the sidebar frontend.</p>
<p>In a pilot study (N=8), writers found questions and rhetorical moves to be useful. Although writers chose to request examples more often, they often rejected the suggested text. Overall, they rated the Questions suggestion type as most compelling (desirable) in post-task surveys, followed by Examples. These preliminary results suggest that writers welcomed AI suggestions that could not be inserted verbatim into their documents but instead required further thought. Overall, by offering intentionally-incomplete suggestions like Questions or Rhetorical Moves, AI systems might become better cognitive partners for writers, enriching thinking rather than circumventing it. The students have presented this work at internal venues; we are designing a follow-up experiment to build on these findings for broader publication.</p>
</section>
<section id="interaction-required-content-suggestions" class="level3">
<h3 class="anchored" data-anchor-id="interaction-required-content-suggestions">Interaction-Required Content Suggestions</h3>
<p>The prior project manipulated the <em>type</em> of AI-generated content but used conventional interaction techniques; what if we presented typical types of content, but through interaction modalities that invite thinking? For example, consider a revision task, like a writer trying to adapt their work for a non-expert audience. An LLM can be used in at least 3 different ways for a task like this: directly generating the complete revised document (requiring no direct interaction), providing the revision as predictive text for the writer one word at a time (showing incremental contextual alternatives and requiring choices at each step), or showing the writer’s original document annotated with alternative words the LLM might generate if generating that document (focusing human attention and requiring the writer to make any edits themselves).</p>
<p>In work in progress, my undergraduate research team is using prototypes we made of these interactions to study how the differences in interaction paradigm expressed in these three interfaces affect the writer’s sense of authorship/ownership, how helpful the AI system is for achieving their goal, and other factors like the writer’s awareness of audience and sensitivity to AI bias. To support these interactions efficiently, we needed to implement custom inference code that interfaces with open-weights LLMs at a lower level than is typically used. Specifically, I used the forward pass of the model to compute single-step next-token predictive distributions rather than a batch-generated response, then manually managed the KV cache to generate lookahead tokens.</p>
</section>
</section>
<section id="supporting-reflection-on-writing" class="level2">
<h2 class="anchored" data-anchor-id="supporting-reflection-on-writing">Supporting Reflection on Writing</h2>
<section id="textfocals-ai-views-for-revising" class="level3">
<h3 class="anchored" data-anchor-id="textfocals-ai-views-for-revising">Textfocals: AI Views for Revising</h3>
<p>Could AI help writers <em>think about their text from the perspective of their readers</em> and revise to serve them better? This work builds on theories of writing process and reflection for revision <span class="citation" data-cites="4814 4813">[@4814; @4813]</span>. I worked with 7 undergraduate researchers in Summer 2023 to develop Textfocals, a Microsoft Word sidebar add-in that provides writers LLM-powered tools to reflect on their writing and set revision goals. Built-in tools provide several types of summaries and questions, but writers can also customize the prompts.</p>
<p>A formative user study with Textfocals <span class="citation" data-cites="50">[@50]</span> yielded promising evidence that this approach could help people develop underdeveloped ideas, cater to the rhetorical audience, and clarify their writing. However, the students running the study and analyzing the findings identified interaction design challenges related to document navigation and scoping, prompt engineering, and context management, leading to substantial reworks of the interaction design. Our work shows the breadth of the design space of writing support interfaces powered by generative AI that maintain authorship integrity.</p>
</section>
<section id="reflective-dialogue" class="level3">
<h3 class="anchored" data-anchor-id="reflective-dialogue">Reflective Dialogue</h3>
<p>An advanced undergraduate student is currently working with me and another co-advisor to refine the kind of reflection-promoting interactions that we started exploring in Textfocals. The current work focuses on helping the writer actively reflect on their rhetorical situation (who the writer is addressing, why, and how) and their writing. The AI-powered system can then help the writer set revision goals grounded in their rhetorical situation and consider multiple approaches to achieving those goals. The student is specifically interested in how using <em>speech</em> as a modality for reflection might affect the quality of a reflective dialogue.</p>
<p>Although I try to give students specific and reasonably scoped tasks, I also try to involve them at least lightly in the whole research process (from design to writing to reviewing) and let them experience the adventure of uncertain research and face it with courage. The student who is doing this project is an example of the success of that strategy: the vision of the project motivated him enough to start a follow-up project on his own initiative.</p>
</section>
</section>
<section id="future-directions" class="level2">
<h2 class="anchored" data-anchor-id="future-directions">Future Directions</h2>
<p>My team is currently finalizing a Microsoft Word add-in store submission for our add-in, which we are now calling Thoughtful (since it includes both drafting and revision features), and making plans for a longitudinal study of its real-world use. Other near-term plans include a follow-up study on Thought Embers, a study of how interaction-required suggestions affect ownership in revision tasks, and a study on modality of interaction with AI in reflection for text revision. All these aim for publication in archival venues such as ACM CHI, UIST, or IUI.</p>
<p>My work is currently funded by an NSF CRII grant (like NSF CAREER grants but for primarily-undergraduate institutions), and I use a mix of NSF ACCESS cyberinfrastructure and a small GPU workstation on campus. I plan to apply for more funding next year when the CRII grant runs out.</p>
<section id="visions-for-cross-disciplinary-collaboration" class="level3">
<h3 class="anchored" data-anchor-id="visions-for-cross-disciplinary-collaboration">Visions for Cross-Disciplinary Collaboration</h3>
<p>I am particularly interested in three promising areas for collaboration:</p>
<ol type="1">
<li><p>Working with <strong>writing and rhetoric</strong> scholars to study how AI-assisted tools might explicitly scaffold writing processes that instructors want to emphasize. This collaboration would build on our work on Textfocals while bringing in deeper theoretical frameworks.</p></li>
<li><p>Working with <strong>education</strong> scholars to develop and study AI systems that help instructors better understand their learners better and make student-centered revisions to their teaching and materials? I have already started to explore some ideas, but I look forward to engaging these questions more deeply with domain experts. For example:</p>
<ul>
<li><p>I have started building LMS extensions that give feedback on <em>instructor</em> content (not student content, for privacy reasons) to help taking the perspective of students: predicting what clarifying questions students will have about assignments, quiz questions, logistics, or policies.</p></li>
<li><p>I have done some formative work with a language education scholar on how we might build fine-grained models of learner knowledge to adaptively differentiate instruction within classes. Current high-fidelity language modeling approaches aim to mimic highly competent linguistic behavior. High-fidelity modeling of non-expert (student) behavior could enable precisely differentiated instruction (e.g., personalized glosses in language education) where each learner stays exactly in their zone of proximal development within an authentic learning community (such as a classroom).</p></li>
</ul></li>
</ol>
<ul>
<li><p>Working with <strong>organizational behavior and communication scholars</strong>: to explore how thoughtful AI (reflection-promoting interfaces) might improve group decision-making and communication. Examples could include:</p>
<ul>
<li><p>Aiding in reflective revision of organizational communication materials (perhaps as add-ins for other software like Outlook and PowerPoint). For example, for an organizational email communication, the system could encourage the sender to consider how will various stakeholders perceive the decision being communicated.</p></li>
<li><p>Reflective/critical AI help for leaders and facilitators: to flag potentially excluded stakeholders or unvoiced concerns or suggest interventions aimed at increasing understanding or surface unvoiced concerns.</p></li>
<li></li>
</ul></li>
</ul>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>We can—and must—build AI to help people think better about other people. To do so, we need cross-disciplinary theoretical grounding, intentional co-design of AI and HCI, and empirical study both in the lab and through deployed systems. My research agenda welcomes students and experts in many disciplines to contribute to building a more caring world through thoughtful AI.</p>
</section>
<section id="references" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="references">References</h2>


</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>See <a href="https://kenarnold.org/projects.html" class="uri">https://kenarnold.org/projects.html</a> for papers and demos of the projects mentioned here.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/kenarnold\.org\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>